(function($,gettext,document){var Marky={createSimpleToolbar:function(toolbarSel,textareaSel,options){var defaults={cannedResponses:false,privateMessaging:false};var settings=$.extend({},defaults,options);var SB=Marky.SimpleButton;var buttons=[new SB(gettext("Bold"),"'''","'''",gettext("bold text"),"btn-bold"),new SB(gettext("Italic"),"''","''",gettext("italic text"),"btn-italic"),new Marky.Separator,new Marky.LinkButton,new Marky.Separator,new SB(gettext("Numbered List"),"# ","",gettext("Numbered list item"),"btn-ol",true),new SB(gettext("Bulleted List"),"* ","",gettext("Bulleted list item"),"btn-ul",true)];if(settings.mediaButton){buttons.splice(4,0,new Marky.MediaButton)}if(settings.cannedResponses){buttons.push(new Marky.Separator,new Marky.CannedResponsesButton)}if(settings.privateMessaging){buttons.push(new Marky.Separator,new Marky.QuoteButton)}Marky.createCustomToolbar(toolbarSel,textareaSel,buttons)},createFullToolbar:function(toolbarSel,textareaSel){var SB=Marky.SimpleButton,buttons=Marky.allButtons();Marky.createCustomToolbar(toolbarSel,textareaSel,buttons)},createCustomToolbar:function(toolbarSel,textareaSel,partsArray){var $toolbar=$(toolbarSel||".editor-tools"),textarea=$(textareaSel||"#reply-content, #id_content")[0];for(var i=0,l=partsArray.length;i<l;i++){$toolbar.append(partsArray[i].bind(textarea).node())}},allButtons:function(){var SB=Marky.SimpleButton;return[new SB(gettext("Bold"),"'''","'''",gettext("bold text"),"btn-bold"),new SB(gettext("Italic"),"''","''",gettext("italic text"),"btn-italic"),new Marky.Separator,new Marky.LinkButton,new Marky.MediaButton,new Marky.Separator,new SB(gettext("Numbered List"),"# ","",gettext("Numbered list item"),"btn-ol",true),new SB(gettext("Bulleted List"),"* ","",gettext("Bulleted list item"),"btn-ul",true),new Marky.Separator,new SB(gettext("Heading 1"),"=","=",gettext("Heading 1"),"btn-h1",true),new SB(gettext("Heading 2"),"==","==",gettext("Heading 2"),"btn-h2",true),new SB(gettext("Heading 3"),"===","===",gettext("Heading 3"),"btn-h3",true)]}};Marky.SimpleButton=function(name,openTag,closeTag,defaultText,classes,everyline){this.name=name;this.classes="";this.openTag=openTag;this.closeTag=closeTag;this.defaultText=defaultText;this.everyline=everyline;if(undefined!==classes){this.classes=classes}this.html='<button class="markup-toolbar-button" />'};Marky.SimpleButton.prototype={bind:function(textarea){this.textarea=textarea;return this},render:function(){var $out=$(this.html).attr({title:this.name}).html(this.name);$out.addClass(this.classes);return $out},node:function(){var me=this,$btn=this.render();$btn.click(function(e){me.handleClick(e)});return $btn[0]},getSelectedText:function(){var selText="";if(window.codemirror&&window.highlighting.isEnabled()){var editor=window.highlighting.editor;return editor.getSelection()}if(document.selection&&document.selection.createRange){selText=document.selection.createRange().text}else if(this.textarea.selectionStart||parseInt(this.textarea.selectionStart)===0){selText=this.textarea.value.substring(this.textarea.selectionStart,this.textarea.selectionEnd)}return selText},handleClick:function(e){var selText,selStart,selEnd,splitText,range,textarea=this.textarea,scrollTop=$(textarea).scrollTop(),editor=window.highlighting&&window.highlighting.editor;if(window.codemirror&&window.highlighting&&window.highlighting.isEnabled()){selText=editor.somethingSelected()?editor.getSelection():this.defaultText;selText=this.openTag+selText+this.closeTag;editor.replaceSelection(selText);editor.focus();e.preventDefault();return false}textarea.focus();if(document.selection&&document.selection.createRange){range=document.selection.createRange();selText=range.text;if(!selText.length){selText=this.defaultText}if(this.everyline&&-~selText.indexOf("\n")){splitText=this._applyEveryLine(this.openTag,this.closeTag,selText);range.text=splitText.join("\n")}else{range.text=this.openTag+selText+this.closeTag;if(range.moveStart){range.moveStart("character",-1*this.openTag.length-selText.length);range.moveEnd("character",-1*this.closeTag.length)}}range.select()}else if(textarea.selectionStart||parseInt(textarea.selectionStart)===0){selStart=textarea.selectionStart;selEnd=textarea.selectionEnd;selText=textarea.value.substring(selStart,selEnd);if(!selText.length){selText=this.defaultText}if(this.everyline&&-~selText.indexOf("\n")){splitText=this._applyEveryLine(this.openTag,this.closeTag,selText).join("\n");textarea.value=textarea.value.substring(0,textarea.selectionStart)+splitText+textarea.value.substring(textarea.selectionEnd);textarea.selectionStart=selStart;textarea.selectionEnd=textarea.selectionStart+splitText.length}else{textarea.value=textarea.value.substring(0,textarea.selectionStart)+this.openTag+selText+this.closeTag+textarea.value.substring(textarea.selectionEnd);textarea.selectionStart=selStart+this.openTag.length;textarea.selectionEnd=textarea.selectionStart+selText.length}}$(textarea).scrollTop(scrollTop);e.preventDefault();return false},_applyEveryLine:function(opentag,closetag,block){return $.map(block.split("\n"),function(line){return line.replace(/\s+/,"").length?opentag+line+closetag:line})}};Marky.Separator=function(){this.html='<span class="separator"></span>'};Marky.Separator.prototype={node:function(){return $(this.html)[0]},bind:function(){return this}};Marky.LinkButton=function(){this.name=gettext("Insert a link...");this.classes="btn-link";this.openTag="[http://example.com ";this.closeTag="]";this.defaultText=gettext("link text");this.everyline=false;this.origOpenTag=this.openTag;this.origCloseTag=this.closeTag;this.origDefaultText=this.defaultText;this.html='<button class="markup-toolbar-button" />'};Marky.LinkButton.prototype=$.extend({},Marky.SimpleButton.prototype,{node:function(){var me=this,$btn=this.render();$btn.click(function(e){me.openModal(e)});return $btn[0]},reset:function(){this.openTag=this.origOpenTag;this.closeTag=this.origCloseTag;this.defaultText=this.origDefaultText},openModal:function(ev){var me=this,$html=$('<section class="marky">'+'<div class="field">'+"<label>"+gettext("Link text:")+"</label>"+'<input type="text" name="link-text" />'+"</div>"+'<div class="field">'+"<label>"+gettext("Link target:")+"</label>"+'<ol><li class="field"><div class="field radio is-condensed"><input type="radio" name="link-type" id="id_link-type-internal" value="internal" /><label for="id_link-type-internal">'+gettext("Support article:")+"</label></div>"+'<input type="text" name="internal" placeholder="'+gettext("Enter the name of the article")+'" /></li>'+'<li class="field"><div class="field radio is-condensed"><input type="radio" name="link-type" id="id_link-type-external" value="external" /><label for="id_link-type-external">'+gettext("External link:")+"</label></div>"+'<input type="text" name="external" placeholder="'+gettext("Enter the URL of the external link")+'" /></li>'+'</ol><div class="submit sumo-button-wrap align-full reverse-on-desktop"><button type="button" class="sumo-button primary-button"></button>'+'<a href="#cancel" class="kbox-cancel sumo-button secondary-button">'+gettext("Cancel")+"</a></div></section>"),selectedText=me.getSelectedText(),kbox;$html.find('li input[type="text"]').focus(function(){$(this).closest("li").find('input[type="radio"]').click()});var performSectionSearch=function(request){return request.term.indexOf("#")===request.term.length-1};var results=[];var getArticleURL=function(name){for(var i=0;i<results.length;i++){if(name===results[i].label){return results[i].url}}return null};var articleSearch=function(request,response){results=[];$.ajax({url:"/en-US/search",data:{format:"json",q:request.term,a:1,w:1,language:$("html").attr("lang")},dataType:"json",success:function(data,textStatus){$.map(data.results,function(val,i){results.push({label:val.title,url:val.url})});response(results)}})};var sectionSearch=function(request,response){var articleName=request.term.split("#")[0];var articleURL=getArticleURL(articleName);if(!articleURL){return}$.ajax({url:articleURL,dataType:"text",success:function(data,status){var headings=$("[id^='w_']",data);var array=[];if(headings.length===0){array.push({label:gettext("No sections found"),value:request.term.replace("#",""),target:""})}headings.each(function(){var element=this.nodeName;var level=element.substring(1);var label=$(this).text();var target=$(this).attr("id");var value=request.term+target;array.push({label:label,value:value,target:target})});response(array)}})};$html.find('input[name="internal"]').autocomplete({source:function(request,response){if(performSectionSearch(request)){sectionSearch(request,response)}else{articleSearch(request,response)}},select:function(event,ui){if(!ui.item.target){return}var $linktext=$html.find("input[name=link-text]");if($linktext.val()===""){$linktext.val(ui.item.label)}}});$html.find("button").text(gettext("Insert Link")).click(function(e){var val=$html.find('input[type="radio"]:checked').val(),text=$html.find("input[name=link-text]").val(),$internal=$html.find('input[name="internal"]'),$external=$html.find('input[name="external"]');me.reset();if(val==="internal"){var title=$internal.val();if(title){if(title===selectedText){me.openTag="[[";me.closeTag="]]";if(text){me.closeTag="|"+text+me.closeTag}}else{me.openTag="[["+title;if(text){me.openTag+="|"+text}me.openTag+="]] ";me.closeTag="";me.defaultText=""}}else{me.openTag="[[";me.closeTag="]]";if(text){me.closeTag="|"+text+"]]"}me.defaultText=gettext("Knowledge Base Article")}}else{var link=$external.val();if(link){if(link.indexOf("http")!==0){link="http://"+link}me.openTag="["+link+" ";if(text){me.openTag+=text+"] ";me.closeTag="";me.defaultText=""}}else if(text){me.defaultText=text}}me.handleClick(e);kbox.close()});if(selectedText){$html.find('input[name="internal"]').val(selectedText).focus()}kbox=new KBox($html,{title:this.name,destroy:true,modal:true,id:"link-modal",container:$("body"),position:"none"});kbox.open();ev.preventDefault();return false}});Marky.MediaButton=function(){this.name=gettext("Insert media...");this.classes="btn-media";this.openTag="";this.closeTag="";this.defaultText=gettext("media");this.everyline=false;this.html='<button class="markup-toolbar-button" />'};Marky.MediaButton.prototype=$.extend({},Marky.SimpleButton.prototype,{node:function(){var me=this,$btn=this.render();$btn.click(function(e){me.openModal(e)});return $btn[0]},reset:function(){this.openTag="";this.closeTag="";this.defaultText=""},openModal:function(ev){var me=this,$editor=$(me.textarea).closest(".editor"),mediaSearchUrl=$editor.data("media-search-url"),galleryUrl=$editor.data("media-gallery-url"),$html=$('<section class="marky">'+'<div class="filter cf">'+'<form class="simple-search-form" id="gallery-modal-search"><input type="text" name="q" class="searchbox"'+'placeholder="'+gettext("Search Gallery")+'" />'+'<button type="submit" class="submit-button search-button" title="'+gettext("Search Gallery")+'">'+gettext("Search Gallery")+"</button></form>"+'<div class="type">'+"<span>"+gettext("Show:")+"</span>"+'<ol><li data-type="image" class="selected">'+gettext("Images")+"</li>"+'<li data-type="video">'+gettext("Videos")+"</li></ol></div>"+'<div class="locale-filter">'+gettext("Show media for:")+" <select /></div></div>"+'<div class="placeholder" /><div class="submit sumo-button-wrap reverse-on-desktop align-end">'+'<button class="sumo-button primary-button">'+gettext("Insert Media")+"</button>"+'<a href="'+galleryUrl+'#upload" class="upload sumo-button secondary-button" target="_blank">'+gettext("Upload Media")+"</a>"+'<a href="#cancel" class="kbox-cancel sumo-button push-left">'+gettext("Cancel")+"</a></div>"+"</section>"),selectedText=me.getSelectedText(),mediaType=$html.find("div.type li.selected").data("type"),mediaQ="",mediaLocale=$("html").attr("lang"),mediaPage=1,kbox;$html.find("div.type li").click(function(e){var $this=$(this);if(!$this.is(".selected")){$html.find("div.type li.selected").removeClass("selected");$this.addClass("selected");mediaType=$this.data("type");mediaPage=1;updateResults()}e.preventDefault();return false});var $lf=$html.find("div.locale-filter select");$lf.html($("#_languages-select-box").html());$lf.on("change",function(){mediaPage=1;mediaLocale=$(this).val();updateResults()});$html.find("form#gallery-modal-search").submit(function(e){mediaQ=$html.find('input[name="q"]').val();mediaPage=1;updateResults();e.preventDefault();return false});$html.find("a.upload").click(function(e){kbox.close()});$html.delegate("ol.pagination a","click",function(e){mediaPage=parseInt($(this).attr("href").split("&page=")[1],10);updateResults();e.preventDefault();return false});$html.find("div.submit button").click(function(e){me.reset();var $selected=$html.find("#media-list > li.selected");if($selected.length<1){alert(gettext("Please select an image or video to insert."));return false}me.openTag="[[";me.openTag+=mediaType==="image"?"Image":"Video";me.openTag+=":"+$selected.find("a").attr("title")+"]] ";me.handleClick(e);kbox.close()});updateResults();function updateResults(type,q){$html.addClass("processing");$.ajax({url:mediaSearchUrl,type:"GET",data:{type:mediaType,q:mediaQ,page:mediaPage,locale:mediaLocale},dataType:"html",success:function(html){$html.find("div.placeholder").html(html);$html.find("#media-list > li").click(function(e){var $this=$(this),$mediaList=$(this).parent();$mediaList.find("li.selected").removeClass("selected");$this.addClass("selected");e.preventDefault();return false})},error:function(){var message=gettext("Oops, there was an error.");$html.find("div.placeholder").html('<div class="msg">'+message+"</div>")},complete:function(){$html.removeClass("processing")}})}kbox=new KBox($html,{title:this.name,destroy:true,modal:true,id:"media-modal",container:$("body"),position:"none"});kbox.open();ev.preventDefault();return false}});Marky.CannedResponsesButton=function(){this.name=gettext("Common responses");this.classes="btn-cannedresponses";this.openTag="";this.closeTag="";this.defaultText=gettext("cannedresponses");this.everyline=false;this.html='<a class="markup-toolbar-link" href="#"/>'};Marky.CannedResponsesButton.prototype=$.extend({},Marky.SimpleButton.prototype,{node:function(){var me=this,$btn=this.render();$btn.click(function(e){me.openModal(e)});me.getPermissionBits();return $btn[0]},reset:function(){this.openTag="";this.closeTag="";this.defaultText=""},openModal:function(e){var me=this,$editor=$(me.textarea).closest(".editor"),$html=$('<section class="marky">'+'<div class="search simple-search-form">'+'<input type="text" name="q" id="filter-responses-field" placeholder="'+gettext("Search for common responses")+'" class="searchbox"/>'+"</div></div>"+'<div class="area">'+'<div id="responses-area">'+'<h2 class="heading-label">'+gettext("Categories")+"</h2>"+'<ul class="category-list">'+'<li class="status-indicator busy">'+gettext("Loading...")+"</li>"+"</ul></div>"+'<div id="response-list-area">'+'<h2 class="heading-label">'+gettext("Responses")+"</h2>"+'<h4 class="nocat-label">'+gettext("Please select a category from the previous column or start a search.")+"</h4>"+'<p class="response-list"/>'+"</div>"+'<div id="response-content-area">'+'<h2 class="heading-label preview-label">'+gettext("Response editor")+"</h2>"+'<div class="sumo-button-wrap">'+'<button class="toggle-view sumo-button">'+gettext("Switch to preview mode")+"</button>"+"</div>"+'<div class="field has-md-textarea response-preview is-condensed">'+'<textarea id="response-content">'+"</textarea></div>"+'<p class="response-preview-rendered"></p>'+"</div>"+"</div>"+"</div>"+'<div class="placeholder" /><div class="submit sumo-button-wrap" id="response-submit-area">'+'<button id="insert-response" class="sumo-button primary-button">'+gettext("Insert Response")+"</button>"+'<a href="#cancel" class="sumo-button secondary-button kbox-cancel">'+gettext("Cancel")+"</a>"+"</div>"+"</section>"),selectedText=me.getSelectedText(),kbox;var cannedResponsesUrl="/kb/common-forum-responses";var previewUrl="answer-preview-async";function updatePreview(){var response=$("#response-content").val();var token=$("[name=csrfmiddlewaretoken]").attr("value");toggleThrobber(true);$.ajax({type:"POST",url:previewUrl,data:{content:response,csrfmiddlewaretoken:token},dataType:"html",success:function(html){var $container=$(".response-preview-rendered");var $response_preview=$(html).find(".main-content");$container.html($response_preview)},complete:function(){toggleThrobber(false)}})}function getContent(articleUrl){if(!articleUrl||articleUrl.indexOf("/new")!==-1){return}toggleThrobber(true);$.ajax({url:articleUrl+"/edit",dataType:"html",success:function(data,status){var article_src=$("#id_content",data).val();var $textbox=$("#response-content");$textbox.val(article_src);$textbox.data("slug",articleUrl);updatePreview()},complete:function(){toggleThrobber(false)}})}function toggleThrobber(busy){var $label=$(".preview-label");if(busy){$label.addClass("busy")}else{$label.removeClass("busy")}}function isAllowedToUseResponse(response_target){if(response_target.indexOf("#")===-1){return true}var articleUrl=response_target.split("#")[0];var permBits=response_target.split("#")[1];response_target=articleUrl;for(var i=0;i<permBits.length;i++){var bit=permBits[i];if(me.permissionBits.indexOf(bit)!==-1){return true}}return false}function insertResponse(){var sourceContent=$("#response-content").val();var slug=$("#response-content").data("slug");var $responseTextbox=$("#id_content");var targetContent=$responseTextbox.val();trackEvent("Canned response usage",slug);$responseTextbox.val(targetContent+sourceContent)}function searchResponses(term){term=term.toLowerCase().trim();var $searchHeading=$html.find("#response-list-area .heading-label");var $noCategorySelected=$html.find(".nocat-label");var $responseLists=$html.find(".response-list ul");var $responses=$html.find(".response");var $responseListArea=$html.find("#response-list-area");var $responsesArea=$html.find("#responses-area");if(term===""){$searchHeading.text(gettext("Responses"));$responseListArea.removeClass("filtered");$responsesArea.removeClass("filtered");$noCategorySelected.show();$responses.show();$responseLists.hide();return}$responseListArea.addClass("filtered");$responsesArea.addClass("filtered");$searchHeading.text(gettext("Matching responses"));$noCategorySelected.hide();$responseLists.show();$responses.each(function(){var text=$(this).text().toLowerCase();if(text.indexOf(term)===-1){$(this).hide()}else{$(this).show()}})}function loadCannedResponses(){var siteLanguage=window.location.pathname.split("/")[1];var targetUrl="/"+siteLanguage+cannedResponsesUrl;$.ajax({url:targetUrl,type:"GET",dataType:"html",success:function(html){var $categoryList=$(".category-list"),$responsesList=$(".response-list"),$categories=$(html).find("[id^=w_]");$categoryList.empty();$responsesList.empty();$categories.each(function(){var label=$(this).text(),$headingItem=$(document.createElement("li")),$responses=$(document.createElement("ul")).addClass("sidebar-nav").hide(),$catResponses=$(this).nextUntil("[id^=w_]").find("a"),$noCatLabel=$html.find(".nocat-label"),$otherResponses,$otherHeadings;$catResponses.each(function(){var $response=$(document.createElement("li")).addClass("response").text($(this).text());var response_target=$(this).attr("href");var canUseResponse=isAllowedToUseResponse(response_target);response_target=response_target.split("#")[0];if(canUseResponse){$response.click(function(){$(".response-list li").not($(this)).removeClass("selected");$(this).addClass("selected");getContent(response_target)});$responses.append($response)}});$headingItem.addClass("response-heading").text(label).on("click",function(){$noCatLabel.hide();$otherResponses=$responsesList.find("ul").not($responses);$otherResponses.hide();$otherHeadings=$categoryList.find(".response-heading").not($headingItem);$otherHeadings.removeClass("selected");$(this).addClass("selected");$responses.show()});$categoryList.append($headingItem);$responsesList.append($responses)})},error:function(){var statusIndicator=$(".status-indicator");statusIndicator.removeClass("busy");statusIndicator.text(gettext("There was an error checking for canned responses."))}});return true}kbox=new KBox($html,{title:this.name,destroy:true,modal:true,id:"media-modal",container:$("body"),position:"none",preOpen:loadCannedResponses});kbox.open();$html.find("#insert-response").click(function(){insertResponse();kbox.close()});$html.find("#filter-responses-field").keyup(function(){var term=$(this).val();searchResponses(term)});var $previewLabel=$html.find(".preview-label");var $contentArea=$html.find(".response-preview");var $renderedPreview=$html.find(".response-preview-rendered");$html.find(".toggle-view").click(function(){if($contentArea.is(":visible")){updatePreview();$previewLabel.text(gettext("Response preview"));$(this).text(gettext("Switch to edit mode"));$contentArea.hide();$renderedPreview.show()}else{$previewLabel.text(gettext("Response editor"));$(this).text(gettext("Switch to preview mode"));$contentArea.show();$renderedPreview.hide()}});e.preventDefault();return false},permissionBits:[],getPermissionBits:function(){var profile_link=$("#aux-nav .user").attr("href"),me=this;if(!profile_link||profile_link===""){return}$.ajax({url:profile_link,dataType:"html",success:function(data,status){var userGroups=$("#groups li",data);userGroups.each(function(){var group=$(this).text();if(group==="Contributors"){me.permissionBits.push("c")}if(group==="Forum Moderators"){me.permissionBits.push("m")}if(group==="Administrators"){me.permissionBits.push("a")}})}})}});Marky.QuoteButton=function(){var name=gettext("Quote previous message...");var previousContent=$("#read-message").attr("data-message-content");var previousAuthor=$(".from a").text();var previousAuthorLink=$(".from a").attr("href");var quote="["+previousAuthorLink+" "+previousAuthor+"] "+gettext("said")+"\r\n";quote+="<blockquote>\r\n";quote+=previousContent+"\r\n";quote+="</blockquote>\r\n";return new Marky.SimpleButton(name,quote,"","","btn-quote",true)};window.Marky=Marky})(jQuery,gettext,document);(function($){"use strict";function AjaxVote(form,options){AjaxVote.prototype.init.call(this,form,options)}AjaxVote.prototype={init:function(form,options){var self=this,$ajaxForm=$(form),$btns=$ajaxForm.find('[type="submit"], [data-type="submit"]');options=$.extend({positionMessage:false,removeForm:false,replaceFormWithMessage:false},options);self.options=options;self.voted=false;self.$form=$ajaxForm;$btns.click(function(e){if(!self.voted){var $btn=$(this),$form=$btn.closest("form"),url=$form.attr("action"),formDataArray=$form.serializeArray(),data={},i,l;$btns.attr("disabled","disabled");$form.addClass("busy");for(i=0,l=formDataArray.length;i<l;i++){data[formDataArray[i].name]=formDataArray[i].value}data[$btn.attr("name")]=$btn.val();$.ajax({url:url,type:"POST",data:data,dataType:"json",success:function(response){if(response.survey){self.showSurvey(response.survey,$form.parent())}if(response.message){self.showMessage(response.message,$btn,$form)}$btn.addClass("active");$btns.removeAttr("disabled");$form.removeClass("busy");self.voted=true;if(!data.ignored){$(document).trigger("vote",$.extend(data,{url:url}))}self.$form.filter(function(){return!$form.is(this)}).remove()},error:function(){var msg=gettext("There was an error submitting your vote.");self.showMessage(msg,$btn);$btns.removeAttr("disabled");$form.removeClass("busy")}})}$(this).blur();e.preventDefault();return false})},showMessage:function(message,$showAbove,$form){var self=this,$html=$('<div class="ajax-vote-box"><p class="msg document-vote--heading"></p></div>'),offset=$showAbove.offset();$html.find("p").html(message);console.log("options",self.options);if(self.options.positionMessage){$("body").append($html);$html.css({top:offset.top-$html.height()-30,left:offset.left+$showAbove.width()/2-$html.width()/2});var timer=setTimeout(fadeOut,1e4);$("body").one("click",fadeOut)}else if(self.options.replaceFormWithMessage){$form.replaceWith($html.removeClass("ajax-vote-box"))}else{$showAbove.parent().parent().addClass($showAbove.val()).append($html)}function fadeOut(){$html.fadeOut(function(){$html.remove()});if(self.options.removeForm){self.$form.fadeOut(function(){self.$form.remove()})}$("body").unbind("click",fadeOut);clearTimeout(timer)}},showSurvey:function(survey,$container){var $survey=$(survey);var $commentCount=$survey.find("#remaining-characters");var $commentBox=$survey.find("textarea");var maxCount=parseInt($commentCount.text(),10);var $radios=$survey.find("input[type=radio][name=unhelpful-reason]");var $submit=$survey.find("[type=submit], [data-type=submit]");var $reason=$survey.find(".disabled-reason");var $textbox=$survey.find("textarea");$container.after($survey);$container.remove();$submit.prop("disabled",true);function validate(){var checked=$radios.filter(":checked").val();var feedback=$textbox.val();if(checked===undefined||(checked==="other"||checked==="firefox-feedback")&&!feedback){$submit.prop("disabled",true);$reason.fadeIn(600)}else{$submit.prop("disabled",false);$reason.fadeOut(600)}}$commentBox.bind("input",function(){var currentCount=$commentBox.val().length;var checked;if(maxCount-currentCount>=0){$commentCount.text(maxCount-currentCount)}else{$commentCount.text(0);$commentBox.val($commentBox.val().substr(0,maxCount))}validate()});$radios.bind("change",validate);new k.AjaxVote($survey.find("form"),{replaceFormWithMessage:true})}};window.k=window.k||{};window.k.AjaxVote=AjaxVote})(jQuery);(function($){"use strict";function AjaxPreview(el,options){AjaxPreview.prototype.init.call(this,el,options)}AjaxPreview.prototype={init:function(el,options){var self=this,$btn=$(el),o=options||{},previewUrl=o.previewUrl||$btn.data("preview-url"),$preview=o.previewElement&&$(o.previewElement)||$("#"+$btn.data("preview-container-id")),$content=o.contentElement&&$(o.contentElement)||$("#"+$btn.data("preview-content-id")),csrftoken=$btn.closest("form").find("input[name=csrfmiddlewaretoken]").val(),slug=$btn.closest("form").find("input[name=slug]").val()||window.location.pathname,locale=$btn.closest("form").find("[name=locale]").val(),changeHash=o.changeHash===undefined?true:o.changeHash;$btn.click(function(e){e.preventDefault();$(this).attr("disabled","disabled");$(self).trigger("get-preview")});$(self).bind("get-preview",function(e){$.ajax({url:previewUrl,type:"POST",data:{content:$content.val(),slug:slug,locale:locale,csrfmiddlewaretoken:csrftoken},dataType:"html",success:function(html){$(self).trigger("show-preview",[true,html])},error:function(xhr,status,err){console.log(err);var msg=gettext("There was an error generating the preview.");$(self).trigger("show-preview",[false,msg])}})});$(self).bind("show-preview",function(e,success,html){$preview.html(html);if($.fn.lazyload){$preview.find("img.lazy").lazyload()}if(changeHash){document.location.hash=$preview.attr("id")}$btn.removeAttr("disabled");$(self).trigger("done",[success])})}};window.k=window.k||{};window.k.AjaxPreview=AjaxPreview})(jQuery);window.remoteTroubleshooting=window.remoteTroubleshooting||{};(function(window,remoteTroubleshooting){"use strict";var data;remoteTroubleshooting.getData=function(callback,timeout){var timeoutId;if(data){window.setTimeout(function(){callback(data)});return}if(!window.addEventListener){data={};window.setTimeout(function(){callback(data)});return}if(!(window.hasOwnProperty("CustomEvent")&&typeof window.CustomEvent==="function")){data={};window.setTimeout(function(){callback(data)});return}timeout=timeout||1e3;function eject(){data={};callback(data)}window.addEventListener("WebChannelMessageToContent",function(e){if(e.detail.id==="remote-troubleshooting"){window.clearTimeout(timeoutId);data=e.detail.message;if(data===undefined){data={}}window.setTimeout(function(){callback(data)})}});var event=new window.CustomEvent("WebChannelMessageToChrome",{detail:{id:"remote-troubleshooting",message:{command:"request"}}});window.dispatchEvent(event);timeoutId=window.setTimeout(eject,timeout)};remoteTroubleshooting.available=function(callback,timeout){remoteTroubleshooting.getData(function(troubleShootingData){callback(!!troubleShootingData.application)},timeout)}})(window,window.remoteTroubleshooting);(function($){"use strict";function AAQSystemInfo($form){AAQSystemInfo.prototype.init.call(this,$form)}AAQSystemInfo.prototype={init:function($form){var self=this,$input;$form.find('input[name="useragent"]').val(navigator.userAgent);if(BrowserDetect.browser==="fx"&&self.isDesktopFF()||BrowserDetect.browser==="m"&&self.isMobileFF()||BrowserDetect.browser==="fxios"&&self.isFirefoxForIOS()){$input=$form.find('input[name="os"]');if(!$input.val()){$input.val(self.getOS())}$input=$form.find('input[name="ff_version"]');if(!$input.val()){$input.val(self.getFirefoxVersion())}$input=$form.find('input[name="device"]');if(!$input.val()){$input.val(self.getDevice())}$input=$form.find('textarea[name="plugins"]');if(!$input.val()){$input.val(self.getPlugins())}}else{$form.find("li.system-details-info").hide()}self.getTroubleshootingInfo()},getOS:function(){var os=[["Android",/Android/i],["Maemo",/Maemo/i],["Windows 3.11",/Win16/i],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/i],["Windows 98",/(Windows 98)|(Win98)/i],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/i],["Windows XP",/(Windows NT 5.1)|(Windows XP)/i],["Windows Server 2003",/(Windows NT 5.2)/i],["Windows Vista",/(Windows NT 6.0)/i],["Windows 7",/(Windows NT 6.1)/i],["Windows 8",/(Windows NT 6.2)/i],["Windows 8.1",/(Windows NT 6.3)/i],["Windows 10",/(Windows NT 6.4)|(Windows NT 10.0)/i],["Windows NT 4.0",/(Windows NT 4.0)|(WinNT4.0)/i],["Windows ME",/Windows ME/i],["Windows",/(Windows)|(WinNT)/i],["OpenBSD",/OpenBSD/i],["SunOS",/SunOS/i],["Linux",/(Linux)|(X11)/i],["iOS",/(iPhone)|(iPad)|(iPod touch)/i],["Mac OS X 10.4",/(Mac OS X 10.4)/i],["Mac OS X 10.5",/(Mac OS X 10.5)/i],["Mac OS X 10.6",/(Mac OS X 10.6)/i],["Mac OS X 10.7",/(Mac OS X 10.7)/i],["Mac OS X 10.8",/(Mac OS X 10.8)/i],["Mac OS X 10.9",/(Mac OS X 10.9)/i],["Mac OS X 10.10",/(Mac OS X 10.10)/i],["Mac OS",/(Mac_PowerPC)|(Macintosh)/i],["QNX",/QNX/i],["BeOS",/BeOS/i],["OS/2",/OS\/2/i]],ua=navigator.userAgent,i,l;for(i=0,l=os.length;i<l;i++){if(os[i][1].test(ua)){return os[i][0]}}return navigator.oscpu||""},getPlugins:function(){var plugins=[],i,d;for(i=0;i<navigator.plugins.length;i++){d=navigator.plugins[i].description.replace(/<[^>]+>/gi,"");if(plugins.indexOf(d)===-1){plugins.push(d)}}if(plugins.length>0){plugins="* "+plugins.join("\n* ")}else{plugins=""}return plugins},getFirefoxVersion:function(){var version=/Firefox\/(\S+)/i.exec(navigator.userAgent);if(version){return version[1]}version=/FxiOS\/(\S+)/i.exec(navigator.userAgent);if(version){return version[1]}return""},getDevice:function(){var device=/\(Mobile; (.+); .+\)/i.exec(navigator.userAgent);if(device){return device[1]}device=/\((iPad|iPhone|iPod touch);/.exec(navigator.userAgent);if(device){return device[1]}return""},isDesktopFF:function(){return document.location.pathname.indexOf("desktop")>=0||document.location.pathname.indexOf("firefox-enterprise")>=0},isMobileFF:function(){return document.location.pathname.indexOf("mobile")>=0},isFirefoxForIOS:function(){return document.location.pathname.indexOf("ios")>=0},getTroubleshootingInfo:function(addEvent){var self=this;var browserData;if(addEvent===undefined){addEvent=true}if($("#id_troubleshooting").length===0){return}remoteTroubleshooting.available(function(yesno){if(yesno){remoteTroubleshooting.getData(function(data){browserData=data});$("#share-data").click(function(e){e.preventDefault();handleData(browserData);return false})}else{$("#share-data").click(function(e){e.preventDefault();$("#troubleshooting-button").hide();$("#troubleshooting-manual").show();$("#troubleshooting-field").show();return false})}});function handleData(data){var modifiedPreferences=data.modifiedPreferences;data.modifiedPreferences={};for(var key in modifiedPreferences){if(key.indexOf("print.")!==0){data.modifiedPreferences[key]=modifiedPreferences[key]}}data=JSON.stringify(data,null,"  ");$("#id_troubleshooting").val(data);$("#troubleshooting-field").show()}}};window.AAQSystemInfo=AAQSystemInfo})(jQuery);(function($){function init(){var $body=$("body");$(".has-error input, .has-error textarea").first().focus();if($body.is(".new-question")){initQuestion();if(window.location.search.indexOf("step=aaq-register")>-1){trackEvent("Ask A Question Flow","step 1 page")}else if(window.location.search.indexOf("step=aaq-question")>-1){trackEvent("Ask A Question Flow","step 2 page")}}if($body.is(".edit-question")){initQuestion("editing")}if($body.is(".questions")){initTagFilterToggle();$('#flag-filter input[type="checkbox"]').on("click",function(){window.location=$(this).data("url")});if(window.location.pathname.indexOf("questions/new/confirm")>-1){trackEvent("Ask A Question Flow","step 3 confirm page")}}if($body.is(".answers")){$("#support-search input[name=q]").val(k.unquote($.cookie("last_search")));function takeQuestion(){if($(this).val().length>0){var $form=$(this).closest("form");var url=$form.data("take-question-url");var csrftoken=$("input[name=csrfmiddlewaretoken]").val();$.ajax({url:url,method:"POST",beforeSend:function(xhr,settings){xhr.setRequestHeader("X-CSRFToken",csrftoken)}})}}$("#id_content").on("keyup",_.throttle(takeQuestion,6e4));$(document).on("click","#details-edit",function(ev){ev.preventDefault();$("#question-details").addClass("editing")});initHaveThisProblemTooAjax();initHelpfulVote();initCrashIdLinking();initEditDetails();addReferrerAndQueryToVoteForm();initReplyToAnswer();new k.AjaxPreview($("#preview"))}Marky.createSimpleToolbar(".editor-tools","#reply-content, #id_content",{cannedResponses:!$body.is(".new-question")});$("#product-selector select").on("change",function(){var val=$(this).val();var queryParams=k.getQueryParamsAsDict(document.location.toString());if(val===""){delete queryParams.product}else{queryParams.product=val}document.location=document.location.pathname+"?"+$.param(queryParams)});$("[data-sort-questions]").on("change",function(){document.location=$(this).val()})}function initQuestion(action){var $questionForm=$("#question-form");var aaq=new AAQSystemInfo($questionForm);if(action==="editing"){$("#troubleshooting-field").show()}else{hideDetails($questionForm,aaq)}}function isLoggedIn(){return $("#greeting span.user").length>0}function initEditDetails(){$("#details-product").on("change",function(){var $selected;$(this).children().each(function(){if(this.selected){$selected=$(this)}});$("#details-topic").children().remove();$("#details-submit").prop("disabled",true);$.ajax($selected.data("url"),{dataType:"json",success:function(data){for(var i=0;i<data.topics.length;i++){var topic=data.topics[i];var $opt=$("<option />");$opt.attr("value",topic.id);$opt.text(topic.title);$("#details-topic").append($opt)}$("#details-submit").prop("disabled",false)}})})}function hideDetails($form,aaq){$form.find("ul").addClass("hide-details");$form.find("a.show, a.hide").click(function(ev){ev.preventDefault();$(this).closest("li").toggleClass("show").toggleClass("hide").closest("ul").toggleClass("show-details")})}function initHaveThisProblemTooAjax(){var $container=$("#question div.me-too, .question-tools div.me-too");$container.each(function(){initAjaxForm($(this),"form","#vote-thanks")});$container.find("input").click(function(){$(this).attr("disabled","disabled")});$container.delegate(".kbox-close, .kbox-cancel","click",function(ev){ev.preventDefault();$container.unbind().remove()})}function addReferrerAndQueryToVoteForm(){var urlParams=k.getQueryParamsAsDict(),referrer=k.getReferrer(urlParams),query=k.getSearchQuery(urlParams,referrer);$("form.helpful, .me-too form").append($('<input type="hidden" name="referrer"/>').attr("value",referrer)).append($('<input type="hidden" name="query"/>').attr("value",query))}function initHelpfulVote(){$(".sumo-l-two-col--sidebar, #document-list, .answer-tools").each(function(){new k.AjaxVote($(this).find("form.helpful"),{replaceFormWithMessage:true,removeForm:true})})}function initAjaxForm($container,formSelector,boxSelector,onKboxClose){$container.delegate(formSelector,"submit",function(ev){ev.preventDefault();var $form=$(this);var url=$form.attr("action");var data=$form.serialize();$.ajax({url:url,type:"POST",data:data,dataType:"json",success:function(response){if(response.html){if($(boxSelector).length===0){var kbox=new KBox(response.html,{container:$container,preClose:onKboxClose});kbox.open()}else{$(boxSelector).html($(response.html).children())}}else if(response.message){var html='<div class="msg"></div>';$(boxSelector).html(html).find(".msg").text(response.message)}if(!response.ignored){$(document).trigger("vote",$.extend(data,{url:url}))}},error:function(){var message=gettext("There was an error.");alert(message)}});return false})}function initTagFilterToggle(){$("#toggle-tag-filter").click(function(e){e.preventDefault();$("#tag-filter").slideToggle("fast");$(this).toggleClass("off")})}function linkCrashIds(container){if(!container){return}var crashIDRegex=new RegExp("(bp-[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})","g");var crashStatsBase="https://crash-stats.mozilla.com/report/index/";var helpingWithCrashesArticle="/kb/helping-crashes";var iconPath=$("body").data("static-url")+"sumo/img/questions/icon.questionmark.png";var crashReportContainer="<span class='crash-report'>"+"<a href='"+crashStatsBase+"$1' target='_blank'>$1</a>"+"<a href='"+helpingWithCrashesArticle+"' target='_blank'>"+"<img src='"+iconPath+"'></img></a></span>";container.html(container.html().replace(crashIDRegex,crashReportContainer))}k.linkCrashIds=linkCrashIds;function initCrashIdLinking(){var postContents=$(".question .main-content, .answer .main-content, #more-system-details");postContents.each(function(){linkCrashIds($(this))})}function initReplyToAnswer(){$("a.quoted-reply").click(function(){var contentId=$(this).data("content-id"),$content=$("#"+contentId),text=$content.find(".content-raw").text(),user=$content.find(".display-name").text(),reply=template("''<p>{user} [[#{contentId}|{said}]]</p>''\n<blockquote>{text}\n</blockquote>\n\n"),reply_text,$textarea=$("#id_content"),oldtext=$textarea.val();reply_text=reply({user:user,contentId:contentId,text:text,said:gettext("said")});$textarea.val(oldtext+reply_text);setTimeout(function(){$textarea.focus()},10);return true})}$(document).ready(init)})(jQuery);(function($){var DEFAULT_SETTINGS={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:false,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:true,theme:null,resultsFormatter:function(item){return"<li>"+item[this.propertyToSearch]+"</li>"},tokenFormatter:function(item){return"<li><p>"+item[this.propertyToSearch]+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:false,tokenValue:"id",onResult:null,onAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:false};var DEFAULT_CLASSES={tokenList:"token-input-list",token:"token-input-token",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",disabled:"token-input-disabled"};var POSITION={BEFORE:0,AFTER:1,END:2};var KEY={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188};var methods={init:function(url_or_data_or_function,options){var settings=$.extend({},DEFAULT_SETTINGS,options||{});return this.each(function(){$(this).data("tokenInputObject",new $.TokenList(this,url_or_data_or_function,settings))})},clear:function(){this.data("tokenInputObject").clear();return this},add:function(item){this.data("tokenInputObject").add(item);return this},remove:function(item){this.data("tokenInputObject").remove(item);return this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(disable){this.data("tokenInputObject").toggleDisabled(disable);return this}};$.fn.tokenInput=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{return methods.init.apply(this,arguments)}};$.TokenList=function(input,url_or_data,settings){if($.type(url_or_data)==="string"||$.type(url_or_data)==="function"){settings.url=url_or_data;var url=computeURL();if(settings.crossDomain===undefined){if(url.indexOf("://")===-1){settings.crossDomain=false}else{settings.crossDomain=location.href.split(/\/+/g)[1]!==url.split(/\/+/g)[1]}}}else if(typeof url_or_data==="object"){settings.local_data=url_or_data}if(settings.classes){settings.classes=$.extend({},DEFAULT_CLASSES,settings.classes)}else if(settings.theme){settings.classes={};$.each(DEFAULT_CLASSES,function(key,value){settings.classes[key]=value+"-"+settings.theme})}else{settings.classes=DEFAULT_CLASSES}var saved_tokens=[];var token_count=0;var cache=new $.TokenList.Cache;var timeout;var input_val;var input_box=$('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",settings.idPrefix+input.id).focus(function(){if(settings.disabled){return false}else if(settings.tokenLimit===null||settings.tokenLimit!==token_count){show_dropdown_hint()}}).blur(function(){hide_dropdown();$(this).val("")}).bind("keyup keydown blur update",resize_input).keydown(function(event){var previous_token;var next_token;switch(event.keyCode){case KEY.LEFT:case KEY.RIGHT:case KEY.UP:case KEY.DOWN:if(!$(this).val()){previous_token=input_token.prev();next_token=input_token.next();if(previous_token.length&&previous_token.get(0)===selected_token||next_token.length&&next_token.get(0)===selected_token){if(event.keyCode===KEY.LEFT||event.keyCode===KEY.UP){deselect_token($(selected_token),POSITION.BEFORE)}else{deselect_token($(selected_token),POSITION.AFTER)}}else if((event.keyCode===KEY.LEFT||event.keyCode===KEY.UP)&&previous_token.length){select_token($(previous_token.get(0)))}else if((event.keyCode===KEY.RIGHT||event.keyCode===KEY.DOWN)&&next_token.length){select_token($(next_token.get(0)))}}else{var dropdown_item=null;if(event.keyCode===KEY.DOWN||event.keyCode===KEY.RIGHT){dropdown_item=$(selected_dropdown_item).next()}else{dropdown_item=$(selected_dropdown_item).prev()}if(dropdown_item.length){select_dropdown_item(dropdown_item)}return false}break;case KEY.BACKSPACE:previous_token=input_token.prev();if(!$(this).val().length){if(selected_token){delete_token($(selected_token));hidden_input.change()}else if(previous_token.length){select_token($(previous_token.get(0)))}return false}else if($(this).val().length===1){hide_dropdown()}else{setTimeout(function(){do_search()},5)}break;case KEY.TAB:case KEY.ENTER:case KEY.NUMPAD_ENTER:case KEY.COMMA:if(selected_dropdown_item){add_token($(selected_dropdown_item).data("tokeninput"));hidden_input.change();return false}break;case KEY.ESCAPE:hide_dropdown();return true;default:if(String.fromCharCode(event.which)){setTimeout(function(){do_search()},5)}break}});var hidden_input=$(input).hide().val("").focus(function(){input_box.focus()}).blur(function(){input_box.blur()});var selected_token=null;var selected_token_index=0;var selected_dropdown_item=null;var token_list=$("<ul />").addClass(settings.classes.tokenList).click(function(event){var li=$(event.target).closest("li");if(li&&li.get(0)&&$.data(li.get(0),"tokeninput")){toggle_select_token(li)}else{if(selected_token){deselect_token($(selected_token),POSITION.END)}input_box.focus()}}).mouseover(function(event){var li=$(event.target).closest("li");if(li&&selected_token!==this){li.addClass(settings.classes.highlightedToken)}}).mouseout(function(event){var li=$(event.target).closest("li");if(li&&selected_token!==this){li.removeClass(settings.classes.highlightedToken)}}).insertBefore(hidden_input);var input_token=$("<li />").addClass(settings.classes.inputToken).appendTo(token_list).append(input_box);var dropdown=$("<div>").addClass(settings.classes.dropdown).appendTo("body").hide();var input_resizer=$("<tester/>").insertAfter(input_box).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:input_box.css("fontSize"),fontFamily:input_box.css("fontFamily"),fontWeight:input_box.css("fontWeight"),letterSpacing:input_box.css("letterSpacing"),whiteSpace:"nowrap"});hidden_input.val("");var li_data=settings.prePopulate||hidden_input.data("pre");if(settings.processPrePopulate&&$.isFunction(settings.onResult)){li_data=settings.onResult.call(hidden_input,li_data)}if(li_data&&li_data.length){$.each(li_data,function(index,value){insert_token(value);checkTokenLimit()})}if(settings.disabled){toggleDisabled(true)}if($.isFunction(settings.onReady)){settings.onReady.call()}this.clear=function(){token_list.children("li").each(function(){if($(this).children("input").length===0){delete_token($(this))}})};this.add=function(item){add_token(item)};this.remove=function(item){token_list.children("li").each(function(){if($(this).children("input").length===0){var currToken=$(this).data("tokeninput");var match=true;for(var prop in item){if(item[prop]!==currToken[prop]){match=false;break}}if(match){delete_token($(this))}}})};this.getTokens=function(){return saved_tokens};this.toggleDisabled=function(disable){toggleDisabled(disable)};function toggleDisabled(disable){if(typeof disable==="boolean"){settings.disabled=disable}else{settings.disabled=!settings.disabled}input_box.prop("disabled",settings.disabled);token_list.toggleClass(settings.classes.disabled,settings.disabled);if(selected_token){deselect_token($(selected_token),POSITION.END)}hidden_input.prop("disabled",settings.disabled)}function checkTokenLimit(){if(settings.tokenLimit!==null&&token_count>=settings.tokenLimit){input_box.hide();hide_dropdown();return}}function resize_input(){if(input_val===(input_val=input_box.val())){return}var escaped=input_val.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");input_resizer.html(escaped);input_box.width(input_resizer.width()+30)}function is_printable_character(keycode){return keycode>=48&&keycode<=90||keycode>=96&&keycode<=111||keycode>=186&&keycode<=192||keycode>=219&&keycode<=222}function insert_token(item){var this_token=settings.tokenFormatter(item);this_token=$(this_token).addClass(settings.classes.token).insertBefore(input_token);$("<span>"+settings.deleteText+"</span>").addClass(settings.classes.tokenDelete).appendTo(this_token).click(function(){if(!settings.disabled){delete_token($(this).parent());hidden_input.change();return false}});var token_data=item;$.data(this_token.get(0),"tokeninput",item);saved_tokens=saved_tokens.slice(0,selected_token_index).concat([token_data]).concat(saved_tokens.slice(selected_token_index));selected_token_index++;update_hidden_input(saved_tokens,hidden_input);token_count+=1;if(settings.tokenLimit!==null&&token_count>=settings.tokenLimit){input_box.hide();hide_dropdown()}return this_token}function add_token(item){var callback=settings.onAdd;if(token_count>0&&settings.preventDuplicates){var found_existing_token=null;token_list.children().each(function(){var existing_token=$(this);var existing_data=$.data(existing_token.get(0),"tokeninput");if(existing_data&&existing_data.id===item.id){found_existing_token=existing_token;return false}});if(found_existing_token){select_token(found_existing_token);input_token.insertAfter(found_existing_token);input_box.focus();return}}if(settings.tokenLimit==null||token_count<settings.tokenLimit){insert_token(item);checkTokenLimit()}input_box.val("");hide_dropdown();if($.isFunction(callback)){callback.call(hidden_input,item)}}function select_token(token){if(!settings.disabled){token.addClass(settings.classes.selectedToken);selected_token=token.get(0);input_box.val("");hide_dropdown()}}function deselect_token(token,position){token.removeClass(settings.classes.selectedToken);selected_token=null;if(position===POSITION.BEFORE){input_token.insertBefore(token);selected_token_index--}else if(position===POSITION.AFTER){input_token.insertAfter(token);selected_token_index++}else{input_token.appendTo(token_list);selected_token_index=token_count}input_box.focus()}function toggle_select_token(token){var previous_selected_token=selected_token;if(selected_token){deselect_token($(selected_token),POSITION.END)}if(previous_selected_token===token.get(0)){deselect_token(token,POSITION.END)}else{select_token(token)}}function delete_token(token){var token_data=$.data(token.get(0),"tokeninput");var callback=settings.onDelete;var index=token.prevAll().length;if(index>selected_token_index)index--;token.remove();selected_token=null;input_box.focus();saved_tokens=saved_tokens.slice(0,index).concat(saved_tokens.slice(index+1));if(index<selected_token_index)selected_token_index--;update_hidden_input(saved_tokens,hidden_input);token_count-=1;if(settings.tokenLimit!==null){input_box.show().val("").focus()}if($.isFunction(callback)){callback.call(hidden_input,token_data)}}function update_hidden_input(saved_tokens,hidden_input){var token_values=$.map(saved_tokens,function(el){if(typeof settings.tokenValue=="function")return settings.tokenValue.call(this,el);return el[settings.tokenValue]});hidden_input.val(token_values.join(settings.tokenDelimiter))}function hide_dropdown(){dropdown.hide().empty();selected_dropdown_item=null}function show_dropdown(){dropdown.css({position:"absolute",top:$(token_list).offset().top+$(token_list).outerHeight(),left:$(token_list).offset().left,width:$(token_list).width(),"z-index":999}).show()}function show_dropdown_searching(){if(settings.searchingText){dropdown.html("<p>"+settings.searchingText+"</p>");show_dropdown()}}function show_dropdown_hint(){if(settings.hintText){dropdown.html("<p>"+settings.hintText+"</p>");show_dropdown()}}function highlight_term(value,term){return value.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+term+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")}function find_value_and_highlight_term(template,value,term){return template.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+value+")(?![^<>]*>)(?![^&;]+;)","g"),highlight_term(value,term))}function populate_dropdown(query,results){if(results&&results.length){dropdown.empty();var dropdown_ul=$("<ul>").appendTo(dropdown).mouseover(function(event){select_dropdown_item($(event.target).closest("li"))}).mousedown(function(event){add_token($(event.target).closest("li").data("tokeninput"));hidden_input.change();return false}).hide();$.each(results,function(index,value){var this_li=settings.resultsFormatter(value);this_li=find_value_and_highlight_term(this_li,value[settings.propertyToSearch],query);this_li=$(this_li).appendTo(dropdown_ul);if(index%2){this_li.addClass(settings.classes.dropdownItem)}else{this_li.addClass(settings.classes.dropdownItem2)}if(index===0){select_dropdown_item(this_li)}$.data(this_li.get(0),"tokeninput",value)});show_dropdown();if(settings.animateDropdown){dropdown_ul.slideDown("fast")}else{dropdown_ul.show()}}else{if(settings.noResultsText){dropdown.html("<p>"+settings.noResultsText+"</p>");show_dropdown()}}}function select_dropdown_item(item){if(item){if(selected_dropdown_item){deselect_dropdown_item($(selected_dropdown_item))}item.addClass(settings.classes.selectedDropdownItem);selected_dropdown_item=item.get(0)}}function deselect_dropdown_item(item){item.removeClass(settings.classes.selectedDropdownItem);selected_dropdown_item=null}function do_search(){var query=input_box.val();if(query&&query.length){if(selected_token){deselect_token($(selected_token),POSITION.AFTER)}if(query.length>=settings.minChars){show_dropdown_searching();clearTimeout(timeout);timeout=setTimeout(function(){run_search(query)},settings.searchDelay)}else{hide_dropdown()}}}function run_search(query){var cache_key=query+computeURL();var cached_results=cache.get(cache_key);if(cached_results){populate_dropdown(query,cached_results)}else{if(settings.url){var url=computeURL();var ajax_params={};ajax_params.data={};if(url.indexOf("?")>-1){var parts=url.split("?");ajax_params.url=parts[0];var param_array=parts[1].split("&");$.each(param_array,function(index,value){var kv=value.split("=");ajax_params.data[kv[0]]=kv[1]})}else{ajax_params.url=url}ajax_params.data[settings.queryParam]=query;ajax_params.type=settings.method;ajax_params.dataType=settings.contentType;if(settings.crossDomain){ajax_params.dataType="jsonp"}ajax_params.success=function(results){if($.isFunction(settings.onResult)){results=settings.onResult.call(hidden_input,results)}cache.add(cache_key,settings.jsonContainer?results[settings.jsonContainer]:results);if(input_box.val()===query){populate_dropdown(query,settings.jsonContainer?results[settings.jsonContainer]:results)}};$.ajax(ajax_params)}else if(settings.local_data){var results=$.grep(settings.local_data,function(row){return row[settings.propertyToSearch].toLowerCase().indexOf(query.toLowerCase())>-1});if($.isFunction(settings.onResult)){results=settings.onResult.call(hidden_input,results)}cache.add(cache_key,results);populate_dropdown(query,results)}}}function computeURL(){var url=settings.url;if(typeof settings.url=="function"){url=settings.url.call(settings)}return url}};$.TokenList.Cache=function(options){var settings=$.extend({max_size:500},options);var data={};var size=0;var flush=function(){data={};size=0};this.add=function(query,results){if(size>settings.max_size){flush()}if(!data[query]){size+=1}data[query]=results};this.get=function(query){return data[query]}}})(jQuery);(function($){function init($container){var $form=$container?$container.find("form"):$("#tag-filter form"),$tags=$form.find('input[type="text"]'),$btn=$form.find('input[type="submit"], button'),$hidden=$('<input type="hidden"/>'),vocab=$tags.data("vocabulary"),lowerVocab={};if(!$form.length){return}_.each(_.keys(vocab),function(name){lowerVocab[name.toLowerCase()]=vocab[name]});$hidden.attr("name",$tags.attr("name")).appendTo($form);$tags.removeAttr("name");$btn.attr("disabled","disabled");$tags.keyup(function(){if($tags.val()){$btn.removeAttr("disabled")}else{$btn.attr("disabled","disabled")}});if($tags.autocomplete){$tags.autocomplete({source:_.keys(vocab),delay:0,minLength:1})}$form.submit(function(){var tagNames=$tags.val(),slugNames=[],currentSlugs=$form.find("input.current-tagged").val(),slugs,invalid=false;_.each(tagNames.split(","),function(tag){var trimmed=$.trim(tag),slug=lowerVocab[trimmed.toLowerCase()];if(slug){slugNames.push(slug)}else if(trimmed){invalid=true;alert(interpolate(gettext("Invalid tag entered: %s"),[tag]))}});if(invalid||slugNames.length===0){$form.trigger("ajaxComplete");if(!invalid){alert(gettext("No tags entered."))}return false}slugs=slugNames.join(",");if(currentSlugs){slugs=currentSlugs+","+slugs}$hidden.val(slugs)})}k.TagsFilter={init:init};$(document).ready(function(){k.TagsFilter.init()})})(jQuery);(function($){function init(){initVocab();initTagAdding();initAutoComplete();initTagRemoval()}function initVocab(){$("div.tags[data-tag-vocab-json]").each(function(){var $tagContainer=$(this);var parsedVocab=$tagContainer.data("tag-vocab-json");$tagContainer.data("tagVocab",_.keys(parsedVocab))})}function initAutoComplete(){function makeButtonTender($addForm){var $adder=$addForm.find("input.adder"),$input=$addForm.find("input.autocomplete-tags"),$tagsDiv=$input.closest("div.tags"),canCreateTags=$tagsDiv.data("can-create-tags")!==undefined,vocab=$tagsDiv.data("tagVocab"),$tagList=inputToTagList($input);function tendAddButton(){var tagName=$.trim($input.val()),inVocab=inArrayCaseInsensitive(tagName,vocab)!==-1,isOnscreen=tagIsOnscreen(tagName,$tagList);$adder.attr("disabled",!tagName.length||isOnscreen||!canCreateTags&&!inVocab)}return tendAddButton}function makeVocabCallback($tags){var vocab=$tags.data("tagVocab"),$tagList=$tags.find("ul.tag-list");function vocabCallback(request,response){var appliedTags=getAppliedTags($tagList),vocabMinusApplied=$.grep(vocab,function(e,i){return $.inArray(e,appliedTags)===-1});response(filter(vocabMinusApplied,request.term))}return vocabCallback}$("input.autocomplete-tags").each(function(){var $input=$(this),tender=makeButtonTender($input.closest("form"));$input.autocomplete({source:makeVocabCallback($input.closest("div.tags")),delay:0,minLength:1,close:tender});$input.keyup(tender);$input.bind("autocompletechange",tender)})}function initTagRemoval(){$("div.tags").each(function(){var $div=$(this),async=!$div.hasClass("deferred");$div.find(".tag").each(function(){attachRemoverHandlerTo($(this),async)})});$("form.remove-tag-form").submit(function(){return false})}function attachRemoverHandlerTo($container,async){$container.find(".remover").click(function(){var $remover=$(this),$tag=$remover.closest(".tag"),tagName=$tag.find(".tag-name").text(),csrf=$remover.closest("form").find("input[name=csrfmiddlewaretoken]").val();function makeTagDisappear(){$tag.remove()}if(async){$tag.addClass("in-progress");$.ajax({type:"POST",url:$remover.closest("form.remove-tag-form").data("action-async"),data:{name:tagName,csrfmiddlewaretoken:csrf},success:makeTagDisappear,error:function makeTagReappear(){$tag.removeClass("in-progress")}})}else{makeTagDisappear()}return false})}function addTag($container,async){var $input=$container.find("input.autocomplete-tags"),tagName=$input.val(),vocab=$input.closest("div.tags").data("tagVocab"),tagIndex=inArrayCaseInsensitive(tagName,vocab),csrf=$container.find("input[name=csrfmiddlewaretoken]").val(),$tag;function putTagOnscreen(name){var $tagList=inputToTagList($input);if(!tagIsOnscreen(name,$tagList)){var $li=$("<li class='tag'><span class='tag-name' /><input type='submit' value='&#x2716;' class='remover' /></li> ");if(async){$li.addClass("in-progress")}else{var $hidden=$("<input type='hidden' />");$hidden.attr("value",name);$hidden.attr("name",$input.attr("name"));$li.prepend($hidden);attachRemoverHandlerTo($li,false)}$li.find(".tag-name").text(name);$li.find("input.remover").attr("name","remove-tag-"+name);$tagList.append($li);return $li}}if(tagIndex===-1){if(async){vocab.push(tagName)}}else{tagName=vocab[tagIndex]}$tag=putTagOnscreen(tagName);if($tag&&async){$.ajax({type:"POST",url:$container.data("action-async"),data:{"tag-name":tagName,csrfmiddlewaretoken:csrf},success:function solidifyTag(data){var url=data.tagUrl,tagNameSpan=$tag.find(".tag-name");tagNameSpan.replaceWith($("<a class='tag-name' />").attr("href",url).text(tagNameSpan.text()));$tag.removeClass("in-progress");attachRemoverHandlerTo($tag,true)},error:function disintegrateTag(data){$tag.remove()}})}$input.val("");$container.find("input.adder").attr("disabled",true);return false}function initTagAdding(){$("div.tags input.adder:enabled").attr("disabled",true);$(".tag-adder").each(function(){var $this=$(this),async=!$this.hasClass("deferred");function handler(){return addTag($this,async)}if($this.is("form")){$this.submit(handler)}else{$this.find("input.adder").click(handler)}})}function inputToTagList($input){return $input.closest("div.tags").find("ul.tag-list")}function escapeRegex(value){return value.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")}function filter(array,term){var matcher=new RegExp(escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test(value.label||value.value||value)})}function inArrayCaseInsensitive(str,ary){var matcher=new RegExp("^"+escapeRegex(str)+"$","i");for(var i=0;i<ary.length;i++){if(matcher.test(ary[i])){return i}}return-1}function getAppliedTags($tagList){var tagNames=[];$tagList.find(".tag .tag-name").each(function(i,e){tagNames.push($(e).text())});return tagNames}function tagIsOnscreen(tagName,$tagList){return inArrayCaseInsensitive(tagName,getAppliedTags($tagList))!==-1}$(document).ready(init)})(jQuery);(function($){"use strict";$(document).ready(function(){$('#report-abuse [type="submit"]').on("click",function(ev){ev.preventDefault();var $this=$(this);var $form=$this.closest("form");$.ajax({url:$form.attr("action"),type:"POST",data:$form.serialize(),dataType:"json",success:function(data){$form.siblings(".message").text(data.message);$form.slideUp()},error:function(error){$form.siblings(".message").text(gettext("There was an error. Please try again in a moment."));$form.slideUp()}})})})})(jQuery);(function($){function init(){if(!$("body").is(".answers")){return}$(document).on("vote",function(t,data){var value;var urlParts=data.url.split("/");var lastPart=urlParts[urlParts.length-1];var secondToLastPart=urlParts[urlParts.length-2];var questionPart;var answerPart;if(_gaq){if(lastPart==="vote"){value="Me Too";questionPart=secondToLastPart;answerPart=""}else if(secondToLastPart==="vote"){if("helpful"in data){value="Helpful"}else if("not-helpful"in data){value="Not Helpful"}questionPart=urlParts[urlParts.length-3];answerPart=" - "+lastPart}else{return}trackEvent("Support Forum Vote",value,questionPart+answerPart)}})}$(document).ready(init)})(jQuery);jQuery.fn.wrapDeleteInput=function(options){if(!this.is("input")){return this}options=$.extend({error_title_del:gettext("Error deleting"),error_json:gettext("Please check you are logged in, and try again."),onComplete:function(){}},options);var $that=this,$attachment=$that.closest(".attachment"),$image=$attachment.find(".image");$that.ajaxSubmitInput({url:$that.attr("data-url"),inputEvent:"click",beforeSubmit:function($input){if(confirm(gettext("Are you sure you want delete the image?"))){var $overlay=$input.closest(".overlay",$attachment);if($overlay.length<=0){$overlay=$('<div class="overlay"></div>').appendTo($attachment)}$overlay.show();$image.fadeTo(500,.5)}else{return false}},onComplete:function($input,iframeContent,$options){if(!iframeContent){$image.css("opacity",1);return}var iframeJSON;try{iframeJSON=$.parseJSON(iframeContent)}catch(err){if(err.substr(0,12)==="Invalid JSON"){dialogSet(options.error_json,options.error_title_del);$image.css("opacity",1);return}}if(iframeJSON.status!=="success"){dialogSet(iframeJSON.message,options.error_title_del);$image.css("opacity",1);return}$attachment.remove();options.onComplete()}});return this};jQuery.fn.ajaxSubmitInput=function(options){if(!this.is("input")){return this}options=$.extend({url:"/upload",accept:false,inputEvent:"change",beforeSubmit:function(){},onComplete:function(){}},options);var uniqueID=Math.random()*1e5,$input=this,$parentForm=$input.closest("form"),iframeName="upload_"+uniqueID,$form='<form class="upload-input" action="'+options.url+'" target="'+iframeName+'" method="post" enctype="multipart/form-data"/>',$iframe=$('<iframe name="'+iframeName+'" style="position:absolute;top:-9999px;" />').appendTo("body"),passJSON;if(options.accept){$input.attr("accept",options.accept)}$input.wrap($form);$form=$input.closest("form");$('input[name="csrfmiddlewaretoken"]').first().clone().appendTo($form);$iframe.load(function(){var iframeContent=$iframe[0].contentWindow.document.body.innerHTML;options.onComplete($input,iframeContent,passJSON)});$input.bind(options.inputEvent,function(){passJSON=options.beforeSubmit($input);if(false===passJSON){return false}$form.submit()});return this};$(document).ready(function(){var UPLOAD={max_filename_length:80,error_title_up:gettext("Error uploading image"),error_title_del:gettext("Error deleting image"),error_login:gettext("Please check you are logged in, and try again.")};function dialogSet(inner,title){var kbox=new KBox($("<p/>").text(inner),{title:title,destroy:true,closeOnOutClick:true,modal:true,id:"upload-dialog",container:$("body")});kbox.open()}$("input.delete","div.attachments-list").each(function(){var $form=$(this).closest("form");$(this).wrapDeleteInput({error_title_del:UPLOAD.error_title_del,error_login:UPLOAD.error_login,onComplete:function(){$form.trigger("ajaxComplete")}})});$('div.attachments-upload input[type="file"]').each(function(){var $form=$(this).closest("form");$form.removeAttr("enctype");$(this).ajaxSubmitInput({url:$(this).closest(".attachments-upload").data("post-url"),beforeSubmit:function($input){var $divUpload=$input.closest(".attachments-upload"),$options={progress:$divUpload.find(".upload-progress"),add:$divUpload.find(".add-attachment"),adding:$divUpload.find(".adding-attachment"),loading:$divUpload.find(".uploaded")};$options.filename=$input.val().split(/[\/\\]/).pop();if($options.filename.length>UPLOAD.max_filename_length){$options.filename=$options.filename.substr(0,UPLOAD.max_filename_length-3)+"..."}$options.add.hide();$options.adding.text(interpolate(gettext('Uploading "%s"...'),[$options.filename])).show();$options.loading.removeClass("empty");$options.progress.addClass("show");return $options},onComplete:function($input,iframeContent,$options){var iframeJSON;var upFile;var $thumbnail;var upStatus;$input.closest("form")[0].reset();if(!iframeContent){return}try{iframeJSON=$.parseJSON(iframeContent)}catch(err){if(err.substr(0,12)==="Invalid JSON"){dialogSet(UPLOAD.error_login,UPLOAD.error_title_up)}}upStatus=iframeJSON.status;$options.progress.removeClass("show");if(upStatus==="success"){upFile=iframeJSON.file;upFile.name=$("<div/>").html(upFile.name).text();$thumbnail=$("<img/>").attr({alt:upFile.name,title:upFile.name,width:upFile.width,height:upFile.height,src:upFile.thumbnail_url}).removeClass("upload-progress").wrap('<a class="image" href="'+upFile.url+'"></a>').closest("a").wrap('<div class="attachment"></div>').closest("div").addClass("attachment").insertBefore($options.progress);$thumbnail.prepend('<input type="submit" class="delete" data-url="'+upFile.delete_url+'" value="&#x2716;"/>');$thumbnail.children().first().wrapDeleteInput({error_title_del:UPLOAD.error_title_del,error_login:UPLOAD.error_login,onComplete:function(){$form.trigger("ajaxComplete")}})}else{dialogSet(iframeJSON.message,UPLOAD.error_title_up)}$options.adding.hide();$options.add.show();$form.trigger("ajaxComplete")}})});function initImageModal(){$("article").on("click",".attachments-list a.image",function(ev){ev.preventDefault();var imgUrl=$(this).attr("href"),image=new Image,html='<div><img class="loading" /></div>',kbox=new KBox(html,{modal:true,title:gettext("Image Attachment"),id:"image-attachment-kbox",destroy:true});kbox.open();function setWidth(){$("#image-attachment-kbox").width(image.width).find("img").removeClass("loading").attr("src",imgUrl);kbox.setPosition()}image.onload=setWidth;image.src=imgUrl;if(image.width){setWidth()}})}initImageModal()});
